# 贪骰无厌 2.0 - Can't Stop Game Bot

基于 NapCat 的 QQ 群骰子游戏机器人，带有 PySide6 GM 管理界面。

## 功能特性

### ✅ 完整游戏系统
- 🎲 完整的游戏规则实现
- 📊 数据持久化（SQLite）
- 🎮 支持所有游戏指令
- 🏆 成就系统
- 🛒 道具商店系统
- 😺 特殊功能（摸喵、投喂喵等）

### ✅ QQ机器人
- 📱 基于 NapCat 的 QQ 群机器人
- 🔄 实时消息处理
- 📝 完整指令解析
- 🎯 自动识别游戏指令

### ✅ GM管理界面
- 🗺️ 可视化地图显示
- 👥 玩家信息管理
- 🛒 商店管理
- 📈 游戏统计
- 🔄 实时数据刷新

## 项目结构

```
cant-stop-2.0/
├── bot/                    # QQ机器人模块
│   └── qq_bot.py          # 机器人主程序
├── database/              # 数据库模块
│   ├── schema.py          # 数据库结构
│   ├── models.py          # 数据模型
│   └── dao.py             # 数据访问对象
├── engine/                # 游戏引擎
│   ├── game_engine.py     # 核心游戏逻辑
│   └── command_parser.py  # 指令解析器
├── gui/                   # GUI界面
│   └── gm_window.py       # GM管理界面
├── game/                  # 游戏配置
│   └── board.py           # 棋盘类
├── data/                  # 数据目录
│   ├── board_config.py    # 棋盘配置
│   └── game.db           # 游戏数据库（自动生成）
├── docs/                  # 文档目录
│   ├── 游戏规则说明书.md
│   ├── commands.md        # 指令手册
│   ├── items.md           # 道具说明
│   ├── traps.md           # 陷阱说明
│   ├── encounters.md      # 遭遇说明
│   └── achivements.md     # 成就说明
├── config.json            # 配置文件
├── start_bot.py           # 启动机器人
├── start_gm.py            # 启动GM界面
└── README.md              # 本文件
```

## 安装依赖

```bash
pip install -r requirements.txt
```

### requirements.txt

```
aiohttp>=3.8.0
PySide6>=6.5.0
```

## 配置

编辑 `config.json` 文件:

```json
{
  "bot": {
    "http_host": "127.0.0.1",
    "http_port": 3000,
    "ws_host": "127.0.0.1",
    "ws_port": 3001,
    "admin_qq": "你的QQ号",
    "group_id": "游戏群号"
  },
  "database": {
    "path": "data/game.db"
  }
}
```

## 使用说明

### 1. 启动 NapCat

首先需要启动 NapCat 服务，确保它运行在配置的端口上：
- HTTP API: 默认 `http://127.0.0.1:3000`
- WebSocket: 默认 `ws://127.0.0.1:3001`

### 2. 启动机器人

```bash
python start_bot.py
```

机器人会自动连接到 NapCat，并开始监听群消息。

### 3. 启动GM界面（可选）

```bash
python start_gm.py
```

GM界面可以实时查看和管理游戏状态。

## 游戏指令

### 基础操作

| 指令 | 说明 |
|------|------|
| `选择阵营：收养人` | 选择收养人阵营 |
| `选择阵营：Aeonreth` | 选择 Aeonreth 阵营 |
| `help` | 查看帮助 |

### 游戏进行

| 指令 | 说明 |
|------|------|
| `轮次开始` | 开始新轮次 |
| `.r6d6` | 投掷6个骰子 |
| `7,11` | 记录两个数值 |
| `10` | 记录单个数值 |
| `替换永久棋子` | 主动结束轮次 |
| `进度回退` | 被动结束轮次 |
| `打卡完毕` | 完成打卡 |

### 查询功能

| 指令 | 说明 |
|------|------|
| `查看当前进度` | 查看地图位置 |
| `查看背包` | 查看积分和道具 |
| `成就一览` | 查看所有成就 |
| `道具商店` | 查看商店 |

### 奖励领取

| 指令 | 说明 |
|------|------|
| `领取草图奖励1` | 领取草图打卡奖励（+20分） |
| `领取精致小图奖励1` | 领取精致小图奖励（+80分） |
| `领取精草大图奖励1` | 领取精草大图奖励（+100分） |
| `领取精致大图奖励1` | 领取精致大图奖励（+150分） |
| `我超级满意这张图1` | 附加奖励（+30分/张） |
| `数列7登顶` | 领取登顶奖励 |

### 特殊功能

| 指令 | 说明 |
|------|------|
| `摸摸喵` | 摸喵（每天5次） |
| `投喂喵` | 投喂喵（每天5次） |
| `购买丑喵玩偶` | 购买玩偶（150积分） |
| `捏捏丑喵玩偶` | 使用玩偶（每天3次） |

**注意**: 输入指令时不需要输入【】符号

## GM界面功能

### 地图视图
- 📊 可视化显示16列棋盘
- 🎨 不同颜色标识遭遇/道具/陷阱
- 🔵 蓝色圆点 = 永久标记
- 🟠 橙色方块 = 临时标记
- 🔄 实时更新玩家位置

### 玩家管理
- 👥 查看所有玩家列表
- 📊 查看玩家详细信息
- 🎯 查看玩家位置
- 🏆 查看玩家成就

### 商店管理
- 🛒 查看所有道具
- 🔓 解锁道具
- 📊 查看销售统计

### 系统管理
- 📈 游戏统计信息
- 🔄 刷新数据
- ⚠️ 重置游戏

## 数据持久化

所有游戏数据都存储在 SQLite 数据库中（`data/game.db`），包括：

- 玩家信息（QQ号、昵称、阵营、积分）
- 位置信息（临时标记、永久标记）
- 背包物品
- 成就记录
- 游戏状态
- 商店道具
- 每日限制记录

数据库会在每次启动时自动初始化，并在游戏过程中实时保存。

## 游戏规则

详细游戏规则请参考 `docs/游戏规则说明书.md`。

### 核心规则

1. **投掷骰子**: 每回合投6个骰子，任意分成两组（3+3）并相加
2. **移动标记**: 在对应列上移动临时标记
3. **轮次管理**: 最多同时在3列上放置临时标记
4. **登顶获胜**: 在任意3列登顶即可获胜

## 开发说明

### 数据库结构

主要表：
- `players` - 玩家基础信息
- `player_positions` - 玩家位置
- `player_inventory` - 玩家背包
- `player_achievements` - 成就记录
- `game_state` - 游戏状态
- `shop_items` - 商店道具
- `daily_limits` - 每日限制

### 扩展功能

如需添加新功能：

1. **添加新指令**: 在 `engine/command_parser.py` 中添加模式
2. **添加新逻辑**: 在 `engine/game_engine.py` 中实现方法
3. **更新UI**: 在 `gui/gm_window.py` 中添加显示

### 测试

```bash
# 测试指令解析器
python engine/command_parser.py

# 测试棋盘配置
python game/board.py

# 测试数据库
python database/schema.py
```

## 常见问题

### Q: 机器人无法连接到NapCat?
A: 检查 NapCat 是否正常运行，以及 `config.json` 中的端口配置是否正确。

### Q: 如何重置游戏?
A: 在 GM 界面的"系统管理"选项卡中点击"重置游戏"按钮。

### Q: 数据库文件在哪里?
A: 默认在 `data/game.db`，可以在 `config.json` 中修改路径。

### Q: 如何修改棋盘配置?
A: 编辑 `data/board_config.py` 文件，修改 `BOARD_DATA` 字典。

## 许可证

本项目仅供学习和娱乐使用。

## 作者

由 Claude (Anthropic) 协助开发

---

📖 更多文档请查看 `docs/` 目录
